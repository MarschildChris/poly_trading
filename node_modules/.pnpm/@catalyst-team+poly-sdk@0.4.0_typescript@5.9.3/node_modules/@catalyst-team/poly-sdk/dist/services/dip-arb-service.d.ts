/**
 * DipArbService - Dip Arbitrage Service
 *
 * 暴跌套利服务 - 针对 Polymarket 15分钟/5分钟 UP/DOWN 市场
 *
 * 策略原理：
 * 1. 每个市场有一个 "price to beat"（开盘时的 Chainlink 价格）
 * 2. 结算规则：
 *    - UP 赢：结束时价格 >= price to beat
 *    - DOWN 赢：结束时价格 < price to beat
 *
 * 3. 套利流程：
 *    - Leg1：检测暴跌 → 买入暴跌侧
 *    - Leg2：等待对冲条件 → 买入另一侧
 *    - 利润：总成本 < $1 时获得无风险利润
 *
 * 使用示例：
 * ```typescript
 * const sdk = await PolymarketSDK.create({ privateKey: '...' });
 *
 * // 自动找到并启动
 * await sdk.dipArb.findAndStart({ coin: 'BTC' });
 *
 * // 监听信号
 * sdk.dipArb.on('signal', (signal) => {
 *   console.log(`Signal: ${signal.type} ${signal.side}`);
 * });
 * ```
 */
import { EventEmitter } from 'events';
import { RealtimeServiceV2 } from './realtime-service-v2.js';
import { TradingService } from './trading-service.js';
import { MarketService } from './market-service.js';
import { type DipArbServiceConfig, type DipArbConfigInternal, type DipArbMarketConfig, type DipArbRoundState, type DipArbStats, type DipArbLeg1Signal, type DipArbLeg2Signal, type DipArbExecutionResult, type DipArbScanOptions, type DipArbFindAndStartOptions, type DipArbAutoRotateConfig, type DipArbSettleResult, type DipArbPendingRedemption } from './dip-arb-types.js';
export declare class DipArbService extends EventEmitter {
    private realtimeService;
    private tradingService;
    private marketService;
    private ctf;
    private config;
    private autoRotateConfig;
    private market;
    private currentRound;
    private isRunning;
    private isExecuting;
    private lastExecutionTime;
    private stats;
    private marketSubscription;
    private chainlinkSubscription;
    private rotateCheckInterval;
    private nextMarket;
    private pendingRedemptions;
    private redeemCheckInterval;
    private upAsks;
    private downAsks;
    private priceHistory;
    private readonly MAX_HISTORY_LENGTH;
    private currentUnderlyingPrice;
    private leg1SignalEmitted;
    constructor(realtimeService: RealtimeServiceV2, tradingService: TradingService | null, marketService: MarketService, privateKey?: string, chainId?: number);
    /**
     * Update configuration
     */
    updateConfig(config: Partial<DipArbServiceConfig>): void;
    /**
     * Get current configuration
     */
    getConfig(): DipArbConfigInternal;
    /**
     * Scan for upcoming UP/DOWN markets
     *
     * Uses MarketService.scanCryptoShortTermMarkets()
     */
    scanUpcomingMarkets(options?: DipArbScanOptions): Promise<DipArbMarketConfig[]>;
    /**
     * Find the best market and start monitoring
     */
    findAndStart(options?: DipArbFindAndStartOptions): Promise<DipArbMarketConfig | null>;
    /**
     * Start monitoring a market
     */
    start(market: DipArbMarketConfig): Promise<void>;
    /**
     * Stop monitoring
     */
    stop(): Promise<void>;
    /**
     * Check if service is running
     */
    isActive(): boolean;
    /**
     * Get current market
     */
    getMarket(): DipArbMarketConfig | null;
    /**
     * Get statistics
     */
    getStats(): DipArbStats;
    /**
     * Get current round state
     */
    getCurrentRound(): DipArbRoundState | null;
    /**
     * Get current price to beat
     */
    getPriceToBeat(): number | null;
    /**
     * Execute Leg1 trade
     */
    executeLeg1(signal: DipArbLeg1Signal): Promise<DipArbExecutionResult>;
    /**
     * Execute Leg2 trade
     */
    executeLeg2(signal: DipArbLeg2Signal): Promise<DipArbExecutionResult>;
    /**
     * Merge YES + NO tokens to USDC
     */
    merge(): Promise<DipArbExecutionResult>;
    private handleOrderbookUpdate;
    /**
     * Record current prices to history buffer for sliding window detection
     */
    private recordPriceHistory;
    /**
     * Get price from N milliseconds ago for sliding window detection
     *
     * @param side - 'UP' or 'DOWN'
     * @param msAgo - Milliseconds ago (e.g., 3000 for 3 seconds)
     * @returns Price from that time, or null if not available
     */
    private getPriceFromHistory;
    private handleChainlinkPriceUpdate;
    private checkAndStartNewRound;
    /**
     * Emergency exit Leg1 position when Leg2 times out
     * Sells the Leg1 tokens at market price to avoid unhedged exposure
     */
    private emergencyExitLeg1;
    private detectSignal;
    private detectLeg1Signal;
    private createLeg1Signal;
    private detectLeg2Signal;
    private validateSignalProfitability;
    private handleSignal;
    /**
     * Configure and enable auto-rotate
     *
     * Auto-rotate 会自动：
     * 1. 监控当前市场到期时间
     * 2. 在市场结束前预加载下一个市场
     * 3. 市场结束时自动结算（redeem 或 sell）
     * 4. 无缝切换到下一个 15m 市场
     *
     * @example
     * ```typescript
     * sdk.dipArb.enableAutoRotate({
     *   underlyings: ['BTC', 'ETH'],
     *   duration: '15m',
     *   autoSettle: true,
     *   settleStrategy: 'redeem',
     * });
     * ```
     */
    enableAutoRotate(config?: Partial<DipArbAutoRotateConfig>): void;
    /**
     * Disable auto-rotate
     */
    disableAutoRotate(): void;
    /**
     * Get auto-rotate configuration
     */
    getAutoRotateConfig(): Required<DipArbAutoRotateConfig>;
    /**
     * Manually settle current position
     *
     * 结算策略：
     * - 'redeem': 等待市场结算后 redeem（需要等待结算完成）
     * - 'sell': 直接卖出 token（更快但可能有滑点）
     */
    settle(strategy?: 'redeem' | 'sell'): Promise<DipArbSettleResult>;
    /**
     * Manually rotate to next market
     */
    rotateToNextMarket(): Promise<DipArbMarketConfig | null>;
    private startRotateCheck;
    private stopRotateCheck;
    private startRedeemCheck;
    private stopRedeemCheck;
    /**
     * Add a position to pending redemption queue
     */
    private addPendingRedemption;
    /**
     * Process all pending redemptions
     * Called periodically by redeemCheckInterval
     */
    private processPendingRedemptions;
    /**
     * Get pending redemptions (for debugging/monitoring)
     */
    getPendingRedemptions(): DipArbPendingRedemption[];
    private checkRotation;
    private findNextMarket;
    private settleByRedeem;
    private settleBySell;
    private log;
}
export * from './dip-arb-types.js';
//# sourceMappingURL=dip-arb-service.d.ts.map