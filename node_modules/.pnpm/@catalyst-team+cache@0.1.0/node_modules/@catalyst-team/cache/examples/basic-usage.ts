/**
 * Basic usage example for @catalyst-team/cache
 */
import { createCacheManager, MemoryAdapter, CacheManager } from '../src/index.js';

async function main() {
  console.log('=== @catalyst-team/cache Basic Usage ===\n');

  // Example 1: Memory-only cache
  console.log('1. Memory-only cache:');
  const memoryCache = new CacheManager({
    l1: new MemoryAdapter({ defaultTTL: 60 }),
  });

  await memoryCache.set('user:123', { name: 'Alice', age: 30 });
  const user = await memoryCache.get<{ name: string; age: number }>('user:123');
  console.log('   Cached user:', user);

  // Example 2: Cache-aside pattern
  console.log('\n2. Cache-aside pattern:');
  let apiCallCount = 0;

  async function fetchUser(id: string) {
    apiCallCount++;
    console.log(`   API call #${apiCallCount} for user ${id}`);
    return { id, name: 'Bob', age: 25 };
  }

  const user1 = await memoryCache.getOrSet('user:456', () => fetchUser('456'), { ttl: 60 });
  console.log('   First call:', user1);

  const user2 = await memoryCache.getOrSet('user:456', () => fetchUser('456'), { ttl: 60 });
  console.log('   Second call (cached):', user2);
  console.log('   Total API calls:', apiCallCount); // Should be 1

  // Example 3: Cache statistics
  console.log('\n3. Cache statistics:');
  const stats = memoryCache.getStats();
  console.log('   Stats:', {
    l1Hits: stats.l1Hits,
    l1Misses: stats.l1Misses,
    hitRate: `${(stats.hitRate * 100).toFixed(2)}%`,
  });

  // Example 4: TTL expiration
  console.log('\n4. TTL expiration:');
  await memoryCache.set('temp-key', 'temp-value', { ttl: 1 });
  console.log('   Set temp-key with 1 second TTL');
  console.log('   Immediate get:', await memoryCache.get('temp-key'));

  await new Promise((resolve) => setTimeout(resolve, 1100));
  console.log('   After 1.1 seconds:', await memoryCache.get('temp-key'));

  // Example 5: Using factory function
  console.log('\n5. Using createCacheManager factory:');
  const cache = createCacheManager({
    l1: { defaultTTL: 60, cleanupIntervalMs: 60000 },
  });

  await cache.set('product:789', { name: 'Laptop', price: 999 });
  console.log('   Product:', await cache.get('product:789'));

  console.log('\n=== Done ===');
}

main().catch(console.error);
